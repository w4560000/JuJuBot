/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/three@0.143.0/examples/jsm/loaders/RGBELoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{DataTextureLoader,DataUtils,FloatType,HalfFloatType,LinearEncoding,LinearFilter}from"three";class RGBELoader extends DataTextureLoader{constructor(t){super(t),this.type=HalfFloatType}parse(t){const e=function(t,e){switch(t){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},r=function(t,e,r){e=e||1024;let a=t.pos,n=-1,o=0,i="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(a,a+128)));for(;0>(n=s.indexOf("\n"))&&o<e&&a<t.byteLength;)i+=s,o+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(a,a+128)));return-1<n&&(!1!==r&&(t.pos+=o+n+1),i+s.slice(0,n))},a=function(t,e,r,a){const n=t[e+3],o=Math.pow(2,n-128)/255;r[a+0]=t[e+0]*o,r[a+1]=t[e+1]*o,r[a+2]=t[e+2]*o,r[a+3]=1},n=function(t,e,r,a){const n=t[e+3],o=Math.pow(2,n-128)/255;r[a+0]=DataUtils.toHalfFloat(Math.min(t[e+0]*o,65504)),r[a+1]=DataUtils.toHalfFloat(Math.min(t[e+1]*o,65504)),r[a+2]=DataUtils.toHalfFloat(Math.min(t[e+2]*o,65504)),r[a+3]=DataUtils.toHalfFloat(1)},o=new Uint8Array(t);o.pos=0;const i=function(t){const a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(t.pos>=t.byteLength||!(l=r(t)))return e(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return e(3,"bad initial token");for(s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=r(t),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(a))&&(s.gamma=parseFloat(c[1])),(c=l.match(n))&&(s.exposure=parseFloat(c[1])),(c=l.match(o))&&(s.valid|=2,s.format=c[1]),(c=l.match(i))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:e(3,"missing image size specifier"):e(3,"missing format specifier")}(o);if(-1!==i){const t=i.width,r=i.height,s=function(t,r,a){const n=r;if(n<8||n>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(n!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");const o=new Uint8Array(4*r*a);if(!o.length)return e(4,"unable to allocate buffer space");let i=0,s=0;const l=4*n,c=new Uint8Array(4),f=new Uint8Array(l);let p=a;for(;p>0&&s<t.byteLength;){if(s+4>t.byteLength)return e(1);if(c[0]=t[s++],c[1]=t[s++],c[2]=t[s++],c[3]=t[s++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=n)return e(3,"bad rgbe scanline format");let r,a=0;for(;a<l&&s<t.byteLength;){r=t[s++];const n=r>128;if(n&&(r-=128),0===r||a+r>l)return e(3,"bad scanline data");if(n){const e=t[s++];for(let t=0;t<r;t++)f[a++]=e}else f.set(t.subarray(s,s+r),a),a+=r,s+=r}const d=n;for(let t=0;t<d;t++){let e=0;o[i]=f[t+e],e+=n,o[i+1]=f[t+e],e+=n,o[i+2]=f[t+e],e+=n,o[i+3]=f[t+e],i+=4}p--}return o}(o.subarray(o.pos),t,r);if(-1!==s){let e,o,l;switch(this.type){case FloatType:l=s.length/4;const t=new Float32Array(4*l);for(let e=0;e<l;e++)a(s,4*e,t,4*e);e=t,o=FloatType;break;case HalfFloatType:l=s.length/4;const r=new Uint16Array(4*l);for(let t=0;t<l;t++)n(s,4*t,r,4*t);e=r,o=HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:r,data:e,header:i.string,gamma:i.gamma,exposure:i.exposure,type:o}}}return null}setDataType(t){return this.type=t,this}load(t,e,r,a){return super.load(t,(function(t,r){switch(t.type){case FloatType:case HalfFloatType:t.encoding=LinearEncoding,t.minFilter=LinearFilter,t.magFilter=LinearFilter,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,r)}),r,a)}}export{RGBELoader};
//# sourceMappingURL=/sm/b98aeb7a54ec1a843c0ae6d9a080e8ade46e80df4592717121b106d8fc1d34e3.map